# K6 ë™ì‹œì„± ì œì–´ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸

## ğŸ“ ë””ë ‰í† ë¦¬ êµ¬ì¡°

```
k6-tests/
â”œâ”€â”€ step1-single-product.js       # Step 1: ë‹¨ì¼ ìƒí’ˆ ê²½í•© í…ŒìŠ¤íŠ¸
â”œâ”€â”€ step2-multiple-products.js    # Step 2: ë‹¤ì¤‘ ìƒí’ˆ ë¶„ì‚° í…ŒìŠ¤íŠ¸
â”œâ”€â”€ step3-mixed-scenario.js       # Step 3: í˜¼í•© ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸
â”œâ”€â”€ step4-stock-depletion.js      # Step 4: ì¬ê³  ì†Œì§„ í…ŒìŠ¤íŠ¸
â”œâ”€â”€ analyze.py                    # ê²°ê³¼ ë¶„ì„ ìŠ¤í¬ë¦½íŠ¸ (Python)
â”œâ”€â”€ run-all-tests.sh              # ì „ì²´ í…ŒìŠ¤íŠ¸ ìë™ ì‹¤í–‰
â”œâ”€â”€ test-data.sql                 # í…ŒìŠ¤íŠ¸ìš© ë°ì´í„° (ìƒí’ˆ 10ê°œ, ê° ì¬ê³  100,000)
â”œâ”€â”€ results/                      # í…ŒìŠ¤íŠ¸ ê²°ê³¼ ì €ì¥ ë””ë ‰í† ë¦¬
â””â”€â”€ README.md                     # ì´ íŒŒì¼
```

## ğŸš€ ë¹ ë¥¸ ì‹œì‘

### 1. ì‚¬ì „ ì¤€ë¹„

```bash
# K6 ì„¤ì¹˜ (macOS)
brew install k6

# í…ŒìŠ¤íŠ¸ ë°ì´í„° ì‚½ì…
mysql -u root -p1234 foo < k6-tests/test-data.sql

# ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰
./gradlew bootRun
```

### 2. í…ŒìŠ¤íŠ¸ ì‹¤í–‰

**ì „ì²´ í…ŒìŠ¤íŠ¸ í•œ ë²ˆì— (ê¶Œì¥):**
```bash
./k6-tests/run-all-tests.sh
```

**ê°œë³„ í…ŒìŠ¤íŠ¸:**
```bash
# Step 1: ë‹¨ì¼ ìƒí’ˆ ê²½í•© (ì•½ 7ë¶„)
k6 run --out json=k6-tests/results/step1-result.json k6-tests/step1-single-product.js

# Step 2: ë‹¤ì¤‘ ìƒí’ˆ ë¶„ì‚° (ì•½ 2.5ë¶„)
k6 run --out json=k6-tests/results/step2-result.json k6-tests/step2-multiple-products.js

# Step 3: í˜¼í•© ì‹œë‚˜ë¦¬ì˜¤ (ì•½ 16ë¶„)
k6 run --out json=k6-tests/results/step3-result.json k6-tests/step3-mixed-scenario.js

# Step 4: ì¬ê³  ì†Œì§„ (ì•½ 7ë¶„)
k6 run --out json=k6-tests/results/step4-result.json k6-tests/step4-stock-depletion.js
```

### 3. ê²°ê³¼ í™•ì¸

**HTML ë¦¬í¬íŠ¸ (ìë™ ìƒì„±ë¨):**
```bash
# ê° Stepë³„ HTML ë¦¬í¬íŠ¸ê°€ ìë™ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤
open k6-tests/results/step1-single-product-summary.html
open k6-tests/results/step2-multiple-products-summary.html
open k6-tests/results/step3-mixed-scenario-summary.html
open k6-tests/results/step4-stock-depletion-summary.html
```

**Python ë¶„ì„ ìŠ¤í¬ë¦½íŠ¸ (ì„ íƒ):**
```bash
# ì¶”ê°€ ë¶„ì„ì´ í•„ìš”í•œ ê²½ìš°
python3 k6-tests/analyze.py k6-tests/results/step1-result.json
python3 k6-tests/analyze.py k6-tests/results/step1-result.json --html --csv
```

## ğŸ“Š í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤

### Step 1: ë‹¨ì¼ ìƒí’ˆ ê²½í•© (ìµœì•…ì˜ Lock ê²½í•©)
- **ëª©ì **: Pessimistic Lockì˜ ìµœì•… ì¼€ì´ìŠ¤ ì„±ëŠ¥ ì¸¡ì •
- **íŠ¹ì§•**: ëª¨ë“  ìš”ì²­ì´ ê°™ì€ ìƒí’ˆ(ID=1)ì„ êµ¬ë§¤
- **ì¬ê³ **: 100,000ê°œ
- **VU**: 10 â†’ 50 â†’ 100 â†’ 200 (ì ì§„ì  ì¦ê°€)
- **ì†Œìš” ì‹œê°„**: ~7ë¶„
- **ì˜ˆìƒ ì†Œì§„**: ~450,000ê°œ (ì¬ê³  ì´ˆê³¼, ì¼ë¶€ ì—ëŸ¬ ë°œìƒ ì˜ˆìƒ)
- **ì˜ˆìƒ ê²°ê³¼**: ìˆœì°¨ ì²˜ë¦¬ë¡œ ì¸í•œ ë‚®ì€ TPS, ë†’ì€ ì‘ë‹µ ì‹œê°„, ì¬ê³  ì†Œì§„ í›„ ì—ëŸ¬ìœ¨ ì¦ê°€

### Step 2: ë‹¤ì¤‘ ìƒí’ˆ ë¶„ì‚° (Lock ê²½í•© ìµœì†Œí™”)
- **ëª©ì **: Lock ê²½í•©ì´ ë¶„ì‚°ë  ë•Œì˜ ì„±ëŠ¥ ì¸¡ì •
- **íŠ¹ì§•**: ê° ìš”ì²­ì´ 1~10ë²ˆ ìƒí’ˆ ì¤‘ ëœë¤ ì„ íƒ
- **ì¬ê³ **: ê° 100,000ê°œ
- **VU**: 20 â†’ 100 â†’ 200 â†’ 500
- **ì†Œìš” ì‹œê°„**: ~2.5ë¶„
- **ì˜ˆìƒ ì†Œì§„**: ìƒí’ˆë‹¹ ~2,460ê°œ
- **ì˜ˆìƒ ê²°ê³¼**: Step 1ë³´ë‹¤ ë†’ì€ TPS, ë‚®ì€ ì‘ë‹µ ì‹œê°„

### Step 3: í˜¼í•© ì‹œë‚˜ë¦¬ì˜¤ (ì‹¤ì œ ìš´ì˜ í™˜ê²½)
- **ëª©ì **: ì‹¤ì œ ìš´ì˜ í™˜ê²½ ì‹œë®¬ë ˆì´ì…˜
- **íŠ¹ì§•**:
  - Hot Item: 20% ìš”ì²­ì´ ì¸ê¸° ìƒí’ˆ(ID=1) ì§‘ì¤‘
  - ì¼ë°˜ íŠ¸ë˜í”½: 80% ìš”ì²­ì´ ë‹¤ì–‘í•œ ìƒí’ˆ êµ¬ë§¤
  - ì¥ë°”êµ¬ë‹ˆ: 30% í™•ë¥ ë¡œ ì—¬ëŸ¬ ìƒí’ˆ ë™ì‹œ êµ¬ë§¤ (2~5ê°œ)
  - ìŠ¤íŒŒì´í¬: 10ë¶„ ì‹œì ì— ê°‘ì‘ìŠ¤ëŸ° íŠ¸ë˜í”½ ê¸‰ì¦
- **ì¬ê³ **: ê° 100,000ê°œ
- **VU**: 80~200 (15ë¶„ê°„ ì§€ì†)
- **ì†Œìš” ì‹œê°„**: ~16ë¶„
- **ì˜ˆìƒ ê²°ê³¼**: Hot Itemì€ ë†’ì€ ê²½í•©, ì¼ë°˜ ìƒí’ˆì€ ë¶„ì‚° ì²˜ë¦¬

### Step 4: ì¬ê³  ì†Œì§„ í…ŒìŠ¤íŠ¸ (ì—ëŸ¬ ì²˜ë¦¬ ê²€ì¦)
- **ëª©ì **: ì¬ê³  ì†Œì§„ ì‹œë‚˜ë¦¬ì˜¤ ë° ì—ëŸ¬ ì²˜ë¦¬ ê²€ì¦
- **íŠ¹ì§•**: ìƒí’ˆ ID=1ì— ì´ˆê³ ê°•ë„ ë¶€í•˜ë¥¼ ê°€í•´ ì¬ê³  ì†Œì§„
- **ì¬ê³ **: 100,000ê°œ
- **VU**: 500 â†’ 1000 â†’ 1500 (ìµœëŒ€ ë¶€í•˜)
- **ì†Œìš” ì‹œê°„**: ~7ë¶„
- **ì˜ˆìƒ ì†Œì§„**: ì²˜ìŒ 2~3ë¶„ ë‚´ ì „ì²´ ì†Œì§„
- **ì˜ˆìƒ ê²°ê³¼**:
  - ì„±ê³µ êµ¬ë§¤: ~100,000ê±´
  - ì¬ê³  ë¶€ì¡± ì—ëŸ¬: ~200ë§Œê±´ (ì—ëŸ¬ìœ¨ 95%)
  - ì¬ê³  ì†Œì§„ í›„ ì—ëŸ¬ ì²˜ë¦¬ ë¡œì§ ê²€ì¦

## ğŸ“ˆ ê²°ê³¼ í•´ì„

### ì£¼ìš” ë©”íŠ¸ë¦­

| ë©”íŠ¸ë¦­ | ì˜ë¯¸ | ëª©í‘œ |
|-------|------|------|
| TPS | ì´ˆë‹¹ ì²˜ë¦¬ ìš”ì²­ ìˆ˜ | ë†’ì„ìˆ˜ë¡ ì¢‹ìŒ |
| P95 ì‘ë‹µì‹œê°„ | 95%ì˜ ìš”ì²­ ì‘ë‹µ ì‹œê°„ | < 3ì´ˆ |
| P99 ì‘ë‹µì‹œê°„ | 99%ì˜ ìš”ì²­ ì‘ë‹µ ì‹œê°„ | < 5ì´ˆ |
| ì—ëŸ¬ìœ¨ | ì‹¤íŒ¨í•œ ìš”ì²­ ë¹„ìœ¨ | < 1% |

### Python ë¶„ì„ ìŠ¤í¬ë¦½íŠ¸ ì¶œë ¥ ì˜ˆì‹œ

```
==============================================================
           K6 ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ ê²°ê³¼ ë¶„ì„
==============================================================

ğŸ“Š ì „ì²´ í†µê³„
--------------------------------------------------------------
í…ŒìŠ¤íŠ¸ ì‹œì‘: 2025-12-02 14:30:15
í…ŒìŠ¤íŠ¸ ì¢…ë£Œ: 2025-12-02 14:37:45
ì´ ì†Œìš” ì‹œê°„: 450.00ì´ˆ (7.50ë¶„)
ì´ ìš”ì²­ ìˆ˜: 12,345
ì‹¤íŒ¨í•œ ìš”ì²­: 23 (0.19%)
ì—ëŸ¬ ìˆ˜: 23 (0.19%)
TPS (ì´ˆë‹¹ ìš”ì²­): 27.43

â±ï¸  HTTP ìš”ì²­ ì‘ë‹µ ì‹œê°„ (http_req_duration)
--------------------------------------------------------------
í‰ê·                 234.56ms
P95                 678.90ms
P99                1234.56ms
```

## ğŸ”§ ë¬¸ì œ í•´ê²°

### ëª¨ë“  ìš”ì²­ì´ ì‹¤íŒ¨í•˜ëŠ” ê²½ìš°
```bash
# ì• í”Œë¦¬ì¼€ì´ì…˜ ìƒíƒœ í™•ì¸
curl http://localhost:8080/actuator/health
```

### ì¬ê³ ê°€ ë¶€ì¡±í•œ ê²½ìš°
```bash
# í…ŒìŠ¤íŠ¸ ë°ì´í„° ì¬ì‚½ì… (ëª¨ë“  ìƒí’ˆ ì¬ê³  100,000ê°œë¡œ ë¦¬ì…‹)
mysql -u root -p1234 foo < k6-tests/test-data.sql

# ë˜ëŠ” Docker Compose ì‚¬ìš© ì‹œ
docker-compose exec -T mysql mysql -uroot -p1234 foo < k6-tests/test-data.sql
```

### K6ê°€ ë„ˆë¬´ ë§ì€ VUë¥¼ ìƒì„±í•˜ì§€ ëª»í•˜ëŠ” ê²½ìš°
```bash
# ì‹œìŠ¤í…œ íŒŒì¼ ë””ìŠ¤í¬ë¦½í„° í•œê³„ ì¦ê°€
ulimit -n 10000
```

## ğŸ“š ì°¸ê³  ìë£Œ

- [K6 ê³µì‹ ë¬¸ì„œ](https://k6.io/docs/)
- [K6 ì‹œë‚˜ë¦¬ì˜¤ ê°€ì´ë“œ](https://k6.io/docs/using-k6/scenarios/)
- [K6 ë©”íŠ¸ë¦­ ê°€ì´ë“œ](https://k6.io/docs/using-k6/metrics/)
